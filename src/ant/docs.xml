<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright (C) 2005 - 2008  Eric Van Dewoestine

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<project name="docs" default="docs" basedir="../..">
  <!--
    - Target for generating the javadocs.
    -->
  <target name="javadoc" depends="init"
      description="Generates the javadocs from the src.">
    <mkdir dir="build/doc/api"/>

    <javadoc packagenames="org.eclim" destdir="build/doc/api">
      <classpath refid="classpath"/>
      <fileset dir="src/java">
        <include name="org/ec*/**/*.java"/>
        <exclude name="**/pydev/**/*.java"/>
      </fileset>
    </javadoc>
  </target>

  <!--
    - Runs forrest to generate the docs.
    -->
  <target name="docs" depends="init" description="Builds the documentation.">
    <property name="sphinx.args" value=""/>
    <mkdir dir="build/doc/site"/>

    <!-- generate site documention via sphinx -->
    <exec executable="sphinx-build" failonerror="true" dir=".">
      <arg line="${sphinx.args} -b eclim src/doc/content build/doc/site"/>
    </exec>

    <!-- copy over any images that sphinx neglects to -->
    <copy todir="build/doc/site/_images">
      <fileset dir="src/doc/content/images" includes="**/*"/>
    </copy>

    <!-- support for google sitemaps and analytics -->
    <!--xslt in="src/forrest/content/xdocs/site.xml"
        out="build/doc/forrest/sitemap.xml"
        style="src/ant/xsl/forrest_site-google_sitemap.xsl"/>
    <gzip src="build/doc/forrest/sitemap.xml"
        destfile="build/doc/forrest/site/sitemap.xml.gz"/>
    <touch file="build/doc/forrest/site/google4c368e38cc6ac62e.html"/>
    <replace dir="build/doc/forrest/site" includes="**/*.html">
      <replacetoken><![CDATA[</body>]]></replacetoken>
      <replacevalue><![CDATA[
      <!- - Google Analytics - ->
          <script src="http://www.google-analytics.com/urchin.js"
            type="text/javascript">
          </script>
          <script type="text/javascript">
            _uacct = "UA-575508-1";
            urchinTracker();
          </script>
      <!- - End Google Analytics - ->
      </body>
      ]]></replacevalue>
    </replace-->
  </target>

  <!--
    - Generates vim docs from sphinx files.
    -->
  <!--target name="vimdocs" depends="init"
      description="Builds the vim documentation.">
  </target-->

  <!--
    - Extracts all eclipse doc jars.
    -->
  <target name="eclipse.docs"
      description="Extracts all eclipse doc jars.">
    <for param="doc.jar" delimiter=":">
      <path id="eclipse.docs">
        <fileset dir="${eclipse.home}/plugins" includes="*.doc.*.jar"/>
      </path>
      <sequential>
        <propertyregex override="yes" property="doc.dir" input="@{doc.jar}"
            regexp=".*(org.eclipse.*?)_.*" replace="\1"/>
        <unjar src="@{doc.jar}" dest="${eclipse.home}/docs/${doc.dir}"/>
      </sequential>
    </for>
  </target>

  <!--
    - Extracts all eclipse src zips.
    -->
  <target name="eclipse.src"
      description="Extracts all eclipse src zips.">
    <for param="src.zip" delimiter=":">
      <path id="eclipse.docs">
        <fileset dir="${eclipse.home}/plugins" includes="**/src.zip"/>
      </path>
      <sequential>
        <unzip src="@{src.zip}" dest="${eclipse.home}/src"/>
      </sequential>
    </for>
  </target>

</project>
