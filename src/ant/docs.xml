<?xml version="1.0" encoding="UTF-8"?>
<!--
 Author: Eric Van Dewoestine
-->
<project name="docs" default="docs" basedir="../..">
  <!--
    - Target for generating the javadocs.
    -->
  <target name="javadoc" depends="init"
      description="Generates the javadocs from the src.">
    <mkdir dir="build/doc/api"/>

    <javadoc packagenames="org.eclim" destdir="build/doc/api">
      <classpath refid="classpath"/>
      <fileset dir="src/java">
        <include name="**/*.java"/>
        <exclude name="**/pydev/**/*.java"/>
      </fileset>
    </javadoc>
  </target>

  <!--
    - Runs forrest to generate the docs.
    -->
  <target name="docs" depends="init" description="Builds the documentation.">
    <!-- generate forrest site -->
    <exec executable="${forrest.home}/bin/forrest" failonerror="true" dir=".">
      <arg line="site"/>
    </exec>

    <!-- support for google sitemaps and analytics -->
    <xslt in="src/forrest/content/xdocs/site.xml"
        out="build/doc/forrest/sitemap.xml"
        style="src/ant/xsl/forrest_site-google_sitemap.xsl"/>
    <gzip src="build/doc/forrest/sitemap.xml"
        destfile="build/doc/forrest/site/sitemap.xml.gz"/>
    <touch file="build/doc/forrest/site/google4c368e38cc6ac62e.html"/>
    <replace dir="build/doc/forrest/site" includes="**/*.html">
      <replacetoken><![CDATA[</body>]]></replacetoken>
      <replacevalue><![CDATA[
      <!-- Google Analytics -->
          <script src="http://www.google-analytics.com/urchin.js"
            type="text/javascript">
          </script>
          <script type="text/javascript">
            _uacct = "UA-575508-1";
            urchinTracker();
          </script>
      <!-- End Google Analytics -->
      </body>
      ]]></replacevalue>
    </replace>

    <!-- extract pmwiki -->
    <!--untar src="src/doc/forrest/wiki/pmwiki.tgz"
        dest="build/doc/forrest/site" compression="gzip"/>
    <mkdir dir="build/doc/forrest/site/wiki"/>
    <move todir="build/doc/forrest/site">
      <fileset dir="build/doc/forrest/site" includes="pmwiki-*/**/*"/>
      <mapper type="regexp"
          from="^pmwiki-[0-9]+\.[0-9]+\.[0-9]+(.*)" to="wiki\1"/>
    </move>
    <path id="pmwiki.dir">
      <dirset dir="build/doc/forrest/site" includes="pmwiki*"/>
    </path>
    <property name="pmwiki" refid="pmwiki.dir"/>
    <delete dir="${pmwiki}"/-->

    <!-- copy over any pmwiki config files, etc. -->
    <!--copy todir="build/doc/forrest/site/wiki">
      <fileset dir="src/forrest/wiki" includes="**/*" excludes="pmwiki.tgz"/>
    </copy-->
  </target>

  <!--
    - Generates vim docs from forrest xml files.
    -->
  <!--target name="vimdocs" depends="init"
      description="Builds the vim documentation.">
  </target-->

  <!--
    - Extracts all eclipse doc jars.
    -->
  <target name="eclipse.docs"
      description="Extracts all eclipse doc jars.">
    <for param="doc.jar" delimiter=":">
      <path id="eclipse.docs">
        <fileset dir="${eclipse.home}/plugins" includes="*.doc.*.jar"/>
      </path>
      <sequential>
        <propertyregex override="yes" property="doc.dir" input="@{doc.jar}"
            regexp=".*(org.eclipse.*?)_.*" replace="\1"/>
        <unjar src="@{doc.jar}" dest="${eclipse.home}/docs/${doc.dir}"/>
      </sequential>
    </for>
  </target>

  <!--
    - Extracts all eclipse src zips.
    -->
  <target name="eclipse.src"
      description="Extracts all eclipse src zips.">
    <for param="src.zip" delimiter=":">
      <path id="eclipse.docs">
        <fileset dir="${eclipse.home}/plugins" includes="**/src.zip"/>
      </path>
      <sequential>
        <unzip src="@{src.zip}" dest="${eclipse.home}/src"/>
      </sequential>
    </for>
  </target>

</project>
