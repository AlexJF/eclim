<?xml version="1.0" encoding="UTF-8"?>
<!--
 Author: Eric Van Dewoestine
-->
<project name="docs" default="docs" basedir="../..">

  <!--
    - Target for generating the javadocs.
    -->
  <target name="javadoc" depends="init"
      description="Generates the javadocs from the src.">
    <mkdir dir="build/doc/api"/>

    <javadoc packagenames="org.eclim" destdir="build/doc/api">
      <classpath refid="classpath"/>
      <fileset dir="src">
        <include name="**/*.java"/>
      </fileset>
    </javadoc>
  </target>

  <!--
    - Runs forrest to generate the docs.
    -->
  <target name="docs" depends="init" description="Builds the documentation.">
    <!-- generate forrest site -->
    <exec executable="${forrest.home}/bin/forrest" failonerror="true" dir=".">
      <arg line="site"/>
    </exec>

    <!-- support for google sitemaps and analytics -->
    <xslt in="src/forrest/content/xdocs/site.xml"
        out="build/sitemap.xml"
        style="src/ant/xsl/forrest_site-google_sitemap.xsl"/>
    <gzip src="build/sitemap.xml" destfile="build/site/sitemap.xml.gz"/>
    <touch file="build/site/google4c368e38cc6ac62e.html"/>
    <replace dir="build/site" includes="**/*.html">
      <replacetoken><![CDATA[</body>]]></replacetoken>
      <replacevalue><![CDATA[
      <!-- Google Analytics -->
          <script src="http://www.google-analytics.com/urchin.js"
            type="text/javascript">
          </script>
          <script type="text/javascript">
            _uacct = "UA-575508-1";
            urchinTracker();
          </script>
      <!-- End Google Analytics -->
      </body>
      ]]></replacevalue>
    </replace>

    <!-- extract pmwiki -->
    <untar src="src/forrest/wiki/pmwiki.tgz" dest="build/site" compression="gzip"/>
    <mkdir dir="build/site/wiki"/>
    <move todir="build/site">
      <fileset dir="build/site" includes="pmwiki-*/**/*"/>
      <mapper type="regexp"
          from="^pmwiki-[0-9]+\.[0-9]+\.[0-9]+(.*)" to="wiki\1"/>
    </move>
    <path id="pmwiki.dir">
      <dirset dir="build/site" includes="pmwiki*"/>
    </path>
    <property name="pmwiki" refid="pmwiki.dir"/>
    <delete dir="${pmwiki}"/>

    <!-- copy over any pmwiki config files, etc. -->
    <copy todir="build/site/wiki">
      <fileset dir="src/forrest/wiki" includes="**/*" excludes="pmwiki.tgz"/>
    </copy>
  </target>

  <!--
    - Generates vim docs from forrest xml files.
    -->
  <target name="vimdocs" depends="init"
      description="Builds the vim documentation.">
  </target>

</project>
