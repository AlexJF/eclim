<?xml version="1.0" encoding="UTF-8"?>
<!--
 Author: Eric Van Dewoestine
-->
<project name="dist" default="dist" basedir="../..">
  <!--
    - Target for creating distributable files.
    -->
  <target name="dist" depends="clean,build,javadoc,docs"
      description="Creates the distributable files.">
    <mkdir dir="dist"/>

    <!-- docs archive -->
    <zip destfile="${eclipse.home}/plugins/org.eclim_${eclim.version}/doc.zip">
      <fileset dir="build/doc" includes="**/*"/>
      <fileset dir="build" includes="site/**/*" excludes="site/wiki,site/wiki/**/*"/>
    </zip>

    <!-- src archive -->
    <zip destfile="${eclipse.home}/plugins/org.eclim_${eclim.version}/src.zip">
      <fileset dir="src/java" includes="**/*"/>
    </zip>

    <!-- eclipse plugin archives -->
    <zip destfile="dist/org.eclim_${eclim.version}.zip">
      <fileset dir="${eclipse.home}/plugins/">
        <include name="org.eclim_${eclim.version}/**/*"/>
        <include name="org.eclim.*_${eclim.version}/**/*"/>
        <exclude name="org.eclim.pdt_${eclim.version}/**/*"/>
        <exclude name="org.eclim.pdt_${eclim.version}"/>
        <exclude name="org.eclim.installer*_${eclim.version}/**/*"/>
        <exclude name="org.eclim.installer*_${eclim.version}"/>
        <exclude name="org.eclim_${eclim.version}/bin/native/**/*"/>
        <exclude name="org.eclim_${eclim.version}/bin/ng"/>
        <exclude name="org.eclim_${eclim.version}/bin/eclim*"/>
      </fileset>
      <zipfileset dir="src/shell" prefix="org.eclim_${eclim.version}/bin/">
        <include name="eclim"/>
        <include name="eclim*.bat"/>
        <include name="eclim*.cmd"/>
      </zipfileset>
    </zip>
    <tar destfile="dist/org.eclim_${eclim.version}.tar.gz" compression="gzip">
      <tarfileset dir="${eclipse.home}/plugins/">
        <include name="org.eclim_${eclim.version}/**/*"/>
        <include name="org.eclim.*_${eclim.version}/**/*"/>
        <exclude name="org.eclim.pdt_${eclim.version}/**/*"/>
        <exclude name="org.eclim.pdt_${eclim.version}"/>
        <exclude name="org.eclim.installer*_${eclim.version}/**/*"/>
        <exclude name="org.eclim.installer*_${eclim.version}"/>
        <exclude name="org.eclim_${eclim.version}/bin/native/windows/**/*"/>
        <exclude name="org.eclim_${eclim.version}/bin/ng"/>
        <exclude name="org.eclim_${eclim.version}/bin/eclim*"/>
        <exclude name="org.eclim_${eclim.version}/bin/**/*.bat"/>
        <exclude name="org.eclim_${eclim.version}/bin/**/*.exe"/>
      </tarfileset>
      <tarfileset dir="src/shell"
          prefix="org.eclim_${eclim.version}/bin/" mode="755">
        <include name="eclim"/>
        <include name="eclim.sed"/>
        <include name="eclimd"/>
        <include name="eclimd.sed"/>
      </tarfileset>
    </tar>

    <!-- vim plugins jar -->
    <zip destfile="dist/eclim_vim_${eclim.version}.jar">
      <fileset dir="src/vim">
        <include name="**/*.vim"/>
        <include name="**/*.example"/>
        <exclude name="eclim/indent/php.vim"/>
        <exclude name="**/php/**/*.vim"/>
        <exclude name="**/php"/>
      </fileset>
    </zip>

    <antcall target="installer"/>
  </target>

  <!--
    - Target for creating installer files.
    -->
  <target name="installer" description="Creates the installers.">
    <!-- run formic -->
    <exec executable="${formic.home}/bin/formic" failonerror="true" dir=".">
      <arg line="-buildfile src/installer/build.xml"/>
    </exec>
  </target>

</project>
