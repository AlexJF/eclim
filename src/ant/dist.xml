<?xml version="1.0" encoding="UTF-8"?>
<!--
 Author: Eric Van Dewoestine
-->
<project name="dist" default="dist" basedir="../..">
  <!--
    - Target for creating distributable files.
    -->
  <target name="dist" depends="clean,build,javadoc,docs"
      description="Creates the distributable files.">
    <mkdir dir="dist"/>

    <!-- docs archive -->
    <zip destfile="${eclipse.home}/plugins/org.eclim_${eclim.version}/doc.zip">
      <fileset dir="build/doc" includes="**/*"/>
      <fileset dir="build" includes="site/**/*" excludes="site/wiki,site/wiki/**/*"/>
    </zip>

    <!-- src archive -->
    <zip destfile="${eclipse.home}/plugins/org.eclim_${eclim.version}/src.zip">
      <fileset dir="src/java" includes="**/*"/>
    </zip>

    <!-- eclipse plugin archives -->
    <zip destfile="dist/org.eclim_${eclim.version}.zip">
      <fileset dir="${eclipse.home}/plugins/">
        <include name="org.eclim_${eclim.version}/**/*"/>
        <include name="org.eclim.*_${eclim.version}/**/*"/>
        <exclude name="org.eclim_${eclim.version}/bin/native/**/*"/>
        <exclude name="org.eclim_${eclim.version}/bin/ng"/>
        <exclude name="org.eclim_${eclim.version}/bin/eclim"/>
        <exclude name="org.eclim_${eclim.version}/bin/eclimd"/>
        <exclude name="org.eclim_${eclim.version}/bin/eclim*.sed"/>
        <exclude name="org.eclim_${eclim.version}/log/eclim.log"/>
        <exclude name="org.eclim_${eclim.version}/src"/>
        <exclude name="org.eclim_${eclim.version}/src/**/*"/>
<exclude name="org.eclim.pydev_${eclim.version}"/>
<exclude name="org.eclim.pydev_${eclim.version}/**/*"/>
      </fileset>
    </zip>
    <tar destfile="dist/org.eclim_${eclim.version}.tar.gz" compression="gzip">
      <tarfileset dir="${eclipse.home}/plugins/">
        <include name="org.eclim_${eclim.version}/**/*"/>
        <include name="org.eclim.*_${eclim.version}/**/*"/>
        <exclude name="org.eclim_${eclim.version}/bin/native/windows/**/*"/>
        <exclude name="org.eclim_${eclim.version}/bin/ng"/>
        <exclude name="org.eclim_${eclim.version}/bin/eclim"/>
        <exclude name="org.eclim_${eclim.version}/bin/eclimd"/>
        <exclude name="org.eclim_${eclim.version}/bin/**/*.bat"/>
        <exclude name="org.eclim_${eclim.version}/bin/**/*.exe"/>
        <exclude name="org.eclim_${eclim.version}/log/eclim.log"/>
<exclude name="org.eclim.pydev_${eclim.version}"/>
<exclude name="org.eclim.pydev_${eclim.version}/**/*"/>
      </tarfileset>
      <tarfileset dir="${eclipse.home}/plugins/" mode="755">
        <include name="org.eclim_${eclim.version}/bin/eclim"/>
        <include name="org.eclim_${eclim.version}/bin/eclimd"/>
      </tarfileset>
    </tar>

    <!-- vim plugins jar -->
    <path id="vim.plugins">
      <fileset dir="src/vim" includes="**/*"/>
    </path>
    <property name="vim.plugins" refid="vim.plugins"/>
    <propertyregex property="vim.plugins" input="${vim.plugins}" override="true"
        regexp="[a-zA-Z0-9-/]*?/src/vim/" replace=""/>
    <propertyregex property="vim.plugins" input="${vim.plugins}" override="true"
        regexp=":" replace=","/>
    <zip destfile="dist/eclim_vim_${eclim.version}.jar">
      <fileset dir="${vim.files.home}" includes="${vim.plugins}">
<exclude name="**/python"/>
<exclude name="**/python/**/*"/>
      </fileset>
    </zip>

    <antcall target="installer"/>
  </target>

  <!--
    - Target for creating installer files.
    -->
  <target name="installer" description="Creates the installers.">
    <!-- run formic -->
    <exec executable="${formic.home}/bin/formic" failonerror="true" dir=".">
      <arg line="-buildfile src/installer/build.xml"/>
    </exec>
  </target>

</project>
